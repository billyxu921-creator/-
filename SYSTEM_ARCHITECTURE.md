# 🏗️ 系统架构说明

这个文档用简单的方式解释系统是如何工作的。

---

## 📊 整体流程

```
┌─────────────────────────────────────────────────────────────┐
│                     每天早上8点自动触发                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据获取层                               │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ AkShare  │  │   微博   │  │  小红书  │  │ 东方财富 │   │
│  │ A股数据  │  │ 情绪数据 │  │ 热点数据 │  │ 新闻数据 │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      分析处理层                               │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────────┐  ┌────────────────┐  ┌──────────────┐ │
│  │ 黄金股票筛选   │  │  AI量化选股    │  │ 微博情绪分析 │ │
│  │ • 股本筛选     │  │ • 技术指标     │  │ • 影响力加权 │ │
│  │ • 市值筛选     │  │ • 舆情碰撞     │  │ • 关键词加成 │ │
│  │ • 官方背书     │  │ • AI终选       │  │ • 情绪量化   │ │
│  └────────────────┘  └────────────────┘  └──────────────┘ │
│                                                              │
│  ┌────────────────┐                                         │
│  │ 全网热点发现   │                                         │
│  │ • 多平台探测   │                                         │
│  │ • 词频对比     │                                         │
│  │ • AI识别       │                                         │
│  └────────────────┘                                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      AI增强层                                 │
├─────────────────────────────────────────────────────────────┤
│                    ┌──────────────┐                          │
│                    │ DeepSeek API │                          │
│                    │ • 深度分析   │                          │
│                    │ • 情绪量化   │                          │
│                    │ • 逻辑提取   │                          │
│                    │ • 推荐理由   │                          │
│                    └──────────────┘                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      报告生成层                               │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐  │
│  │              综合投资简报 (Markdown)                  │  │
│  │  • 黄金股票 TOP 5                                     │  │
│  │  • AI选股 TOP 3                                       │  │
│  │  • 微博情绪指数                                       │  │
│  │  • 全网热点雷达                                       │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      邮件推送层                               │
├─────────────────────────────────────────────────────────────┤
│                    ┌──────────────┐                          │
│                    │  SMTP服务    │                          │
│                    │  (QQ邮箱)    │                          │
│                    │  • HTML正文  │                          │
│                    │  • 附件报告  │                          │
│                    └──────────────┘                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                      📧 你的邮箱收到简报
```

---

## 🔄 两种运行模式

### 模式1: GitHub Actions（云端）

```
GitHub Actions (云端)
    │
    ├─ 每天UTC 0:00触发 (北京时间8:00)
    │
    ├─ 运行模块:
    │   ├─ ✅ 黄金股票筛选
    │   ├─ ✅ AI量化选股
    │   ├─ ❌ 微博情绪分析 (需要浏览器)
    │   └─ ❌ 全网热点发现 (需要浏览器)
    │
    ├─ 生成简化版简报
    │
    └─ 发送邮件
```

**优点**: 完全自动化，无需本地运行
**缺点**: 不包含需要浏览器登录的模块

### 模式2: 本地运行（完整版）

```
本地电脑
    │
    ├─ 定时任务触发 (每天8:00)
    │   或手动运行
    │
    ├─ 运行模块:
    │   ├─ ✅ 黄金股票筛选
    │   ├─ ✅ AI量化选股
    │   ├─ ✅ 微博情绪分析
    │   └─ ✅ 全网热点发现
    │
    ├─ 生成完整版简报
    │
    └─ 发送邮件
```

**优点**: 包含所有功能
**缺点**: 需要本地运行，首次需要扫码登录

---

## 🧩 核心模块详解

### 1. 黄金股票筛选器

```
输入: AkShare全A股数据
    │
    ├─ 筛选条件:
    │   ├─ 8亿 ≤ 总股本 ≤ 15亿
    │   ├─ 105亿 ≤ 流通市值 ≤ 195亿
    │   └─ 包含"黄金"关键词
    │
    ├─ 评分系统:
    │   ├─ 股本匹配 (25分)
    │   ├─ 官方背书 (30分)
    │   ├─ 市值匹配 (20分)
    │   └─ 行业匹配 (25分)
    │
    └─ 输出: TOP 5股票 + CSV文件
```

### 2. AI量化选股器

```
Step 1: 技术指标初选
    ├─ 60 < 市值 < 200亿
    ├─ 2% < 涨幅 < 6%
    └─ 换手率 > 5%
    │
    ▼
Step 2: 舆情碰撞
    ├─ 匹配微博热点
    ├─ 匹配小红书热点
    └─ 影响力加权计算
    │
    ▼
Step 3: 综合评分
    ├─ 涨幅 × 30%
    ├─ 换手率 × 20%
    └─ 舆情评分 × 50%
    │
    ▼
Step 4: DeepSeek AI终选
    ├─ 从TOP 10选出TOP 3
    ├─ 生成推荐理由
    └─ 预测止盈位
    │
    ▼
输出: TOP 3潜力股 + Markdown报告
```

### 3. 微博情绪分析器

```
Step 1: 数据抓取
    ├─ Playwright抓取微博
    ├─ 搜索关键词"黄金"
    └─ 获取博主粉丝数
    │
    ▼
Step 2: 数据清洗
    ├─ 过滤广告内容
    ├─ 去重
    └─ 提取有效信息
    │
    ▼
Step 3: 影响力加权
    ├─ 100万+粉丝 × 10
    ├─ 10万+粉丝 × 3
    └─ 其他 × 1
    │
    ▼
Step 4: 关键词加成
    ├─ 检测"涨停"、"重组"等
    └─ 给予20%加成
    │
    ▼
Step 5: DeepSeek AI分析
    ├─ 情绪量化 (0-100)
    ├─ 提取3个风险点
    └─ 提取3个机会点
    │
    ▼
输出: 情绪指数 + Markdown报告
```

### 4. 全网热点发现引擎

```
Step 1: 多平台探测
    ├─ 小红书财经推荐流
    ├─ 微博财经热搜
    └─ 股票超话
    │
    ▼
Step 2: 数据收集
    ├─ 今日热点词频
    └─ 昨日热点词频
    │
    ▼
Step 3: 对比分析
    ├─ 计算词频变化
    ├─ 识别异常升温
    └─ 排除预设板块
    │
    ▼
Step 4: AI智能识别
    ├─ DeepSeek分析
    ├─ 识别TOP 3板块
    └─ 生成投资建议
    │
    ▼
输出: 热点雷达报告 + Markdown
```

---

## 🔐 数据流和安全

### 配置管理

```
本地开发:
    config.py (包含真实密钥)
    ├─ DeepSeek API Key
    ├─ 邮箱配置
    └─ 其他参数

GitHub部署:
    GitHub Secrets (加密存储)
    ├─ DEEPSEEK_API_KEY
    ├─ SMTP配置
    └─ 邮箱信息
    │
    ▼
    运行时动态生成config.py
    (不会暴露在代码仓库中)
```

### 数据安全

```
敏感信息处理:
    ├─ ✅ 使用GitHub Secrets
    ├─ ✅ 不在代码中硬编码
    ├─ ✅ .gitignore排除config.py
    └─ ✅ 建议仓库设为Private
```

---

## 📊 性能指标

### 运行时间

```
GitHub Actions版:
    ├─ 黄金股票筛选: ~2分钟
    ├─ AI量化选股: ~3分钟
    ├─ 报告生成: ~1分钟
    └─ 邮件发送: ~1分钟
    总计: ~7分钟

本地完整版:
    ├─ 黄金股票筛选: ~2分钟
    ├─ AI量化选股: ~3分钟
    ├─ 微博情绪分析: ~5分钟
    ├─ 全网热点发现: ~8分钟
    ├─ 报告生成: ~1分钟
    └─ 邮件发送: ~1分钟
    总计: ~20分钟
```

### 资源消耗

```
GitHub Actions:
    ├─ 每次运行: ~7分钟
    ├─ 每月运行: ~210分钟
    └─ 免费额度: 2000分钟/月
    结论: 完全够用 ✅

DeepSeek API:
    ├─ 每次运行: ~10-20次调用
    ├─ 每月调用: ~300-600次
    └─ 成本: 根据套餐计费

邮件:
    ├─ 每封邮件: ~1-5MB
    ├─ 每月邮件: ~30-150MB
    └─ 成本: 免费 ✅
```

---

## 🔄 扩展性

### 添加新的数据源

```python
# 在相应模块中添加新的数据获取函数
def fetch_new_data_source():
    # 1. 获取数据
    # 2. 清洗数据
    # 3. 返回标准格式
    pass
```

### 添加新的分析模块

```python
# 创建新的分析器
class NewAnalyzer:
    def analyze(self, data):
        # 1. 接收数据
        # 2. 执行分析
        # 3. 返回结果
        pass
```

### 自定义简报格式

```python
# 在daily_email_sender.py中修改
def generate_custom_report():
    # 1. 收集数据
    # 2. 自定义格式
    # 3. 生成报告
    pass
```

---

## 🎯 技术栈总览

```
编程语言:
    └─ Python 3.8+

数据获取:
    ├─ AkShare (A股数据)
    ├─ Playwright (浏览器自动化)
    └─ Requests (HTTP请求)

数据处理:
    ├─ Pandas (数据分析)
    ├─ NumPy (数值计算)
    └─ 正则表达式 (文本处理)

AI分析:
    └─ DeepSeek API (深度学习)

自动化:
    ├─ GitHub Actions (云端)
    ├─ Schedule (本地定时)
    └─ Cron (系统定时)

邮件:
    └─ SMTP (邮件协议)

文件格式:
    ├─ CSV (数据存储)
    ├─ Markdown (报告格式)
    └─ YAML (配置文件)
```

---

## 📈 未来扩展方向

### 可能的增强功能

1. **更多数据源**
   - 雪球
   - 知乎
   - 财经新闻网站

2. **更多分析维度**
   - 技术指标分析
   - 资金流向分析
   - 机构持仓分析

3. **更智能的AI**
   - 多模型对比
   - 历史回测
   - 预测准确率统计

4. **更丰富的报告**
   - HTML格式
   - 图表可视化
   - 交互式报告

5. **更灵活的推送**
   - 微信推送
   - Telegram推送
   - 钉钉推送

---

## 🤝 贡献指南

想要改进系统？

1. Fork项目
2. 创建新分支
3. 提交改进
4. 发起Pull Request

---

**系统架构说明完成！**

如需了解具体实现，请查看各模块的源代码（都有详细的中文注释）。

---

**最后更新**: 2026年1月15日
