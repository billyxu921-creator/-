# 微博情绪分析 - 加权优化版使用指南

> 基于博主影响力和关键词的加权情绪分析系统

---

## 📋 更新内容

### 版本
v2.0 - 加权优化版

### 更新时间
2026-01-15

### 核心优化

1. **博主影响力加权** ⭐
   - 根据粉丝数计算影响力权重
   - 100万+粉丝: 权重×10
   - 10万+粉丝: 权重×3
   - 其他: 权重×1

2. **关键词加成** ⭐
   - 检测关键词: 涨停、重组、入股、并购、收购、增持、回购
   - 加成比例: +20%

3. **加权公式计算** ⭐
   - Final_Score = (AI_Sentiment_Score + Keyword_Bonus) × Influence_Weight
   - 归一化到0-100范围

4. **粉丝数抓取** ⭐
   - 自动提取博主粉丝数
   - 支持"万"、"千"、"百"等单位

---

## 🎯 加权公式详解

### 公式
```
Final_Score = (AI_Sentiment_Score + Keyword_Bonus) × Influence_Weight
```

### 参数说明

#### 1. AI_Sentiment_Score
- **来源**: DeepSeek AI分析的基础情绪分数
- **范围**: 0-100
- **说明**: AI对微博内容的原始情绪判断

#### 2. Keyword_Bonus
- **计算**: AI_Sentiment_Score × 20% (如果包含关键词)
- **关键词**: 涨停、重组、入股、并购、收购、增持、回购
- **示例**: 
  - AI分数50，包含"涨停" → 加成 = 50 × 0.2 = 10
  - AI分数80，包含"重组" → 加成 = 80 × 0.2 = 16

#### 3. Influence_Weight
- **100万+粉丝**: 权重 = 10
- **10万+粉丝**: 权重 = 3
- **其他**: 权重 = 1

### 归一化

**目的**: 确保最终分数在0-100之间

**最大可能值**: (100 + 100×0.2) × 10 = 1200

**归一化公式**: (Final_Score / 1200) × 100

---

## 📊 计算示例

### 示例1: 高影响力博主 + 关键词

**场景**: 
- 博主: 财经大V (200万粉丝)
- 内容: "黄金价格今日涨停，市场情绪高涨！"
- AI基础分数: 80

**计算过程**:
1. 影响力权重: 200万粉丝 → 权重 = 10
2. 关键词加成: 包含"涨停" → 加成 = 80 × 0.2 = 16
3. 加权分数: (80 + 16) × 10 = 960
4. 归一化: (960 / 1200) × 100 = 80.00

**最终分数**: 80.00

---

### 示例2: 中影响力博主 + 关键词

**场景**:
- 博主: 投资专家 (50万粉丝)
- 内容: "某黄金企业宣布重组计划，利好消息"
- AI基础分数: 65

**计算过程**:
1. 影响力权重: 50万粉丝 → 权重 = 3
2. 关键词加成: 包含"重组" → 加成 = 65 × 0.2 = 13
3. 加权分数: (65 + 13) × 3 = 234
4. 归一化: (234 / 1200) × 100 = 19.50

**最终分数**: 19.50

---

### 示例3: 普通博主 + 无关键词

**场景**:
- 博主: 普通用户 (5000粉丝)
- 内容: "黄金价格上涨，值得关注"
- AI基础分数: 50

**计算过程**:
1. 影响力权重: 5000粉丝 → 权重 = 1
2. 关键词加成: 无关键词 → 加成 = 0
3. 加权分数: (50 + 0) × 1 = 50
4. 归一化: (50 / 1200) × 100 = 4.17

**最终分数**: 4.17

---

## 🚀 使用方法

### 1. 安装依赖

```bash
pip3 install playwright pandas requests numpy
playwright install chromium
```

### 2. 运行加权优化版

```bash
python3 weibo_sentiment_weighted.py
```

### 3. 运行测试

```bash
python3 test_weighted_sentiment.py
```

---

## 📈 输出文件

### 1. 原始数据 CSV
**文件名**: `weibo_raw_weighted_YYYYMMDD_HHMMSS.csv`

**新增字段**:
- `粉丝数`: 博主粉丝数量
- `影响力权重`: 计算的影响力权重 (1, 3, 或 10)
- `关键词加成`: 是否包含关键词 (True/False)
- `匹配关键词`: 匹配到的关键词列表

### 2. 清洗数据 CSV
**文件名**: `weibo_clean_weighted_YYYYMMDD_HHMMSS.csv`

**内容**: 过滤广告、去重后的数据

### 3. 分析报告 Markdown
**文件名**: `微博黄金情绪分析_加权版_YYYYMMDD.md`

**新增内容**:
- ⚖️  加权统计
  - 博主影响力分布
  - 关键词加成统计
- 🤖 AI情绪分析（加权优化）
  - AI基础分数 vs 加权平均分数
  - 分数统计（最低、最高、标准差）
- 👑 高影响力博主 TOP 5
- 🔥 包含关键词加成的微博
- 📐 加权公式说明

---

## 📝 报告示例

```markdown
# 微博黄金情绪分析报告（加权优化版）

## ⚖️  加权统计

### 博主影响力分布
- **高影响力博主** (100万+粉丝, 权重×10): 5 条
- **中影响力博主** (10万+粉丝, 权重×3): 12 条
- **普通博主** (权重×1): 31 条

### 关键词加成
- **包含关键词加成**: 8 条 (+20%)
- **关键词**: 涨停, 重组, 入股, 并购, 收购, 增持, 回购

## 🤖 AI情绪分析（加权优化）

### 情绪指数对比

| 指标 | 分数 | 说明 |
|------|------|------|
| AI基础分数 | 68 / 100 | DeepSeek原始分析 |
| 加权平均分数 | 45.32 / 100 | 考虑影响力+关键词 |
| 情绪标签 | 乐观 | - |

**分数统计**:
- 最低分: 3.42
- 最高分: 85.00
- 标准差: 18.56

## 👑 高影响力博主 TOP 5

### 1. @财经大V
- 👥 粉丝数: 2,000,000
- ⚖️  影响力权重: ×10
- 🔑 关键词加成: 是
- 📌 匹配关键词: 涨停

> 黄金价格今日涨停，市场情绪高涨！...

- 👍 点赞: 5000 | 🔄 转发: 2000 | 📅 1小时前
```

---

## 🔍 对比分析

### 原版 vs 加权优化版

| 特性 | 原版 | 加权优化版 |
|------|------|------------|
| 博主影响力 | ❌ 不考虑 | ✅ 粉丝数加权 |
| 关键词加成 | ❌ 不考虑 | ✅ +20%加成 |
| 情绪分数 | 单一分数 | 基础分数+加权分数 |
| 粉丝数抓取 | ❌ 不抓取 | ✅ 自动抓取 |
| 分数归一化 | ❌ 无需 | ✅ 0-100范围 |
| 报告详细度 | 基础 | 详细（含加权统计） |

---

## 💡 使用建议

### 1. 何时使用加权优化版

**推荐场景**:
- 需要区分博主影响力
- 关注重大事件（涨停、重组等）
- 需要更精准的情绪判断

**不推荐场景**:
- 只关注整体情绪趋势
- 数据量较小（<20条）

### 2. 如何解读加权分数

**加权分数 > AI基础分数**:
- 高影响力博主占比高
- 包含关键词的微博多
- 市场关注度高

**加权分数 < AI基础分数**:
- 普通博主占比高
- 缺少关键词
- 市场关注度一般

**加权分数 ≈ AI基础分数**:
- 影响力分布均衡
- 关键词分布均衡

### 3. 关键词自定义

编辑 `weibo_sentiment_weighted.py` 第47行：

```python
self.boost_keywords = ['涨停', '重组', '入股', '并购', '收购', '增持', '回购']
```

添加或删除关键词，如：

```python
self.boost_keywords = ['涨停', '重组', '入股', '突破', '利好', '暴涨']
```

### 4. 调整加成比例

编辑 `weibo_sentiment_weighted.py` 第48行：

```python
self.boost_ratio = 0.20  # 20%加成
```

修改为其他比例，如：

```python
self.boost_ratio = 0.30  # 30%加成
```

---

## 🐛 常见问题

### Q1: 粉丝数抓取失败

**原因**: 微博页面结构变化

**解决方案**:
- 检查页面元素选择器
- 手动补充粉丝数数据

### Q2: 加权分数过低

**原因**: 
- 普通博主占比过高
- 缺少关键词

**解决方案**:
- 增加抓取页数
- 筛选高影响力博主

### Q3: 加权分数过高

**原因**:
- 高影响力博主占比过高
- 关键词密集

**解决方案**:
- 正常现象，说明市场关注度高
- 可以调低加成比例

---

## 📚 相关文档

- **原版指南**: [WEIBO_SENTIMENT_GUIDE.md](WEIBO_SENTIMENT_GUIDE.md)
- **系统总结**: [WEIBO_SYSTEM_SUMMARY.md](WEIBO_SYSTEM_SUMMARY.md)
- **测试脚本**: `test_weighted_sentiment.py`

---

## ⚖️  免责声明

1. 加权算法基于经验设计，不保证绝对准确
2. 粉丝数不完全等于影响力
3. 关键词加成可能存在误判
4. 本工具仅供参考，不构成投资建议

---

**版本**: v2.0  
**更新日期**: 2026-01-15  
**状态**: ✅ 已完成

---

🎉 **加权优化版已上线，立即体验更精准的情绪分析！**

```bash
python3 weibo_sentiment_weighted.py
```
